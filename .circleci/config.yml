verison: 2.1
jobs:
  build:
    machine:
      image: circleci/classic:edge
    steps:
      - checkout
      - run:
          name: コンテナイメージビルド
          command: docker-compose build
      - run:
          name: コンテナ起動
          command: docker-compose up -d
      - run:
          name: データベース作成
          command: docker-compose exec web bin/rails db:create
      - run:
          name: マイグレーション
          command: docker-compose exec web bin/rails db:migrate RAILS_ENV=test
      - run:
          name: slim-lint実行
          command: docker-compose exec web bundle exec slim-lint app/views/
      - run:
          name: rubocop実行
          command: docker-compose exec web bundle exec rubocop --parallel
      - run:
          name: brakeman実行
          command: docker-compose exec web bundle exec brakeman -A -w1
      - run:
          name: RSpec実行
          command: docker-compose exec web bin/rspec
      - run:
          name: コンテナ削除
          command: docker-compose down
